# Conan Setup for Apache Arrow

This project uses [Conan](https://conan.io/) to manage the Apache Arrow C++ dependency.

## Prerequisites

Install Conan 2.x:

```bash
# Using pipx (recommended)
pipx install conan

# Or using pip in a virtual environment
python3 -m venv venv
source venv/bin/activate
pip install conan
```

## Initial Setup

1. **Create Conan profile** (first time only):

```bash
conan profile detect
```

2. **Install Arrow dependencies**:

```bash
conan install . --output-folder=conan_deps --build=missing
```

This will:
- Download Arrow 14.0.1 and its dependencies (Boost, zlib, etc.)
- Build them from source for your platform
- Generate Bazel integration files in `conan_deps/`

**Note**: The first build will take 15-30 minutes as it compiles Boost and Arrow from source.

## Bazel Integration

After running `conan install`, Conan generates Bazel files that are automatically loaded by MODULE.bazel:

```python
# In your BUILD.bazel files, depend on Arrow like this:
cc_library(
    name = "my_library",
    deps = [
        "@arrow//:arrow",  # Generated by Conan
    ],
)
```

## Configuration

The `conanfile.txt` specifies:
- Arrow version 14.0.1
- Static linking (shared=False)
- Minimal build (parquet=False, thrift=False)
- Bazel generators (BazelDeps, BazelToolchain)

## Updating Dependencies

To update to a newer Arrow version:

1. Edit `conanfile.txt` and change the version
2. Re-run `conan install . --output-folder=conan_deps --build=missing`
3. Test that everything builds correctly

## Troubleshooting

### Build failures

If Conan build fails, try:

```bash
# Clean the cache and rebuild
rm -rf conan_deps/
rm -rf ~/.conan2/p/
conan install . --output-folder=conan_deps --build=missing
```

### C++ standard mismatch

The project uses C++23. Ensure your Conan profile is configured correctly:

```bash
# Check profile
conan profile show

# Should show:
#   compiler.cppstd=gnu23
```

If not, edit `~/.conan2/profiles/default` and set `compiler.cppstd=gnu23`.

## CI/CD Integration

For automated builds, add these steps to your CI pipeline:

```bash
# Install Conan
pipx install conan

# Configure profile
conan profile detect

# Install dependencies
conan install . --output-folder=conan_deps --build=missing

# Build with Bazel
bazel build //...
```
