cc_test(
    name = "snapshot_test",
    srcs = ["snapshot_test.cc"],
    deps = [
        "//src:snapshot",
        "@googletest//:gtest_main",
    ],
    copts = ["-std=c++20"],
)

cc_test(
    name = "grid_test",
    srcs = ["grid_test.cc"],
    deps = [
        "//src:grid",
        "@googletest//:gtest_main",
    ],
    copts = ["-std=c++20"],
)

cc_test(
    name = "multigrid_test",
    srcs = ["multigrid_test.cc"],
    deps = [
        "//src:multigrid",
        "//src:grid",
        "@googletest//:gtest",
        "@googletest//:gtest_main",
    ],
    copts = ["-std=c++20", "-Wall", "-Wextra"],
)

cc_test(
    name = "boundary_conditions_test",
    srcs = ["boundary_conditions_test.cc"],
    deps = [
        "//src:boundary_conditions",
        "@googletest//:gtest_main",
    ],
    copts = ["-std=c++20"],
)

cc_test(
    name = "workspace_test",
    srcs = ["workspace_test.cc"],
    deps = [
        "//src:workspace",
        "//src:grid",
        "@googletest//:gtest_main",
    ],
    copts = ["-std=c++20"],
)

cc_test(
    name = "root_finding_test",
    srcs = ["root_finding_test.cc"],
    deps = [
        "//src:root_finding",
        "@googletest//:gtest_main",
    ],
    copts = ["-std=c++20"],
)

cc_test(
    name = "brent_cpp_test",
    srcs = ["brent_cpp_test.cc"],
    deps = [
        "//src:brent",
        "//src:root_finding",
        "@googletest//:gtest_main",
    ],
    copts = ["-std=c++20"],
)

cc_test(
    name = "newton_workspace_test",
    srcs = ["newton_workspace_test.cc"],
    deps = [
        "//src:newton_workspace",
        "//src:workspace",
        "//src:grid",
        "@googletest//:gtest_main",
    ],
    copts = ["-std=c++20"],
)

cc_test(
    name = "spatial_operators_test",
    srcs = ["spatial_operators_test.cc"],
    deps = [
        "//src:spatial_operators",
        "//src:workspace",
        "//src:grid",
        "@googletest//:gtest_main",
    ],
    copts = ["-std=c++20", "-fopenmp-simd"],
)

cc_test(
    name = "pde_solver_test",
    srcs = ["pde_solver_test.cc"],
    deps = [
        "//src:pde_solver",
        "//src:spatial_operators",
        "//src:boundary_conditions",
        "//src:root_finding",
        "//src:snapshot",
        "//src/operators:operator_factory",
        "//src/operators:laplacian_pde",
        "@googletest//:gtest",
        "@googletest//:gtest_main",
    ],
    copts = ["-std=c++20", "-Wall", "-Wextra", "-fopenmp-simd"],
)

cc_test(
    name = "integration_5d_price_table_test",
    srcs = ["integration_5d_price_table_test.cc"],
    deps = [
        "//src:multigrid",
        "//src:workspace",
        "//src:spatial_operators",
        "//src:grid",
        "@googletest//:gtest",
        "@googletest//:gtest_main",
    ],
    copts = ["-std=c++20", "-Wall", "-Wextra", "-fopenmp-simd"],
)

cc_test(
    name = "time_domain_test",
    srcs = ["time_domain_test.cc"],
    deps = [
        "//src:time_domain",
        "@googletest//:gtest",
        "@googletest//:gtest_main",
    ],
    copts = ["-std=c++20", "-Wall", "-Wextra"],
)

cc_test(
    name = "trbdf2_config_test",
    srcs = ["trbdf2_config_test.cc"],
    deps = [
        "//src:trbdf2_config",
        "@googletest//:gtest",
        "@googletest//:gtest_main",
    ],
    copts = ["-std=c++20", "-Wall", "-Wextra"],
)

cc_test(
    name = "tridiagonal_solver_test",
    srcs = ["tridiagonal_solver_test.cc"],
    deps = [
        "//src:thomas_solver",
        "@googletest//:gtest",
        "@googletest//:gtest_main",
    ],
    copts = ["-std=c++20", "-Wall", "-Wextra"],
)

cc_test(
    name = "price_table_snapshot_collector_test",
    srcs = ["price_table_snapshot_collector_test.cc"],
    deps = [
        "//src:price_table_snapshot_collector",
        "//src:snapshot",
        "@googletest//:gtest_main",
    ],
    copts = ["-std=c++20"],
)

cc_test(
    name = "snapshot_optimization_benchmark",
    srcs = ["snapshot_optimization_benchmark.cc"],
    deps = [
        "//src:pde_solver",
        "//src:price_table_snapshot_collector",
        "//src:spatial_operators",
        "//src:boundary_conditions",
        "@googletest//:gtest_main",
    ],
    copts = ["-std=c++20"],
    tags = ["manual", "slow"],  # Excluded from fast CI: benchmark takes ~30-60s
)

cc_test(
    name = "iv_solver_test",
    srcs = ["iv_solver_test.cc"],
    deps = [
        "//src:iv_solver",
        "@googletest//:gtest_main",
    ],
    copts = ["-std=c++20", "-Wall", "-Wextra"],
)

cc_test(
    name = "temporal_event_test",
    size = "small",
    srcs = ["temporal_event_test.cc"],
    deps = [
        "//src:pde_solver",
        "//src:spatial_operators",
        "//src:boundary_conditions",
        "@googletest//:gtest_main",
    ],
    copts = ["-std=c++20", "-fopenmp-simd"],
)

cc_test(
    name = "obstacle_test",
    size = "small",
    srcs = ["obstacle_test.cc"],
    deps = [
        "//src:pde_solver",
        "//src:spatial_operators",
        "//src:boundary_conditions",
        "@googletest//:gtest_main",
    ],
    copts = ["-std=c++20", "-fopenmp-simd"],
)

cc_test(
    name = "grid_spacing_test",
    srcs = ["grid_spacing_test.cc"],
    deps = [
        "//src/operators:grid_spacing",
        "//src:grid",
        "@googletest//:gtest_main",
    ],
    copts = ["-std=c++20"],
)

cc_test(
    name = "centered_difference_test",
    srcs = ["centered_difference_test.cc"],
    deps = [
        "//src/operators:centered_difference",
        "//src/operators:grid_spacing",
        "//src:grid",
        "@googletest//:gtest_main",
    ],
    copts = ["-std=c++20", "-fopenmp-simd"],
)

cc_test(
    name = "spatial_operator_test",
    srcs = ["spatial_operator_test.cc"],
    deps = [
        "//src/operators:spatial_operator",
        "//src/operators:black_scholes_pde",
        "//src/operators:grid_spacing",
        "//src:grid",
        "@googletest//:gtest_main",
    ],
    copts = ["-std=c++20"],
)

cc_test(
    name = "american_option_solver_test",
    size = "small",
    srcs = ["american_option_solver_test.cc"],
    deps = [
        "//src:american_option",
        "@googletest//:gtest_main",
    ],
    copts = ["-std=c++20"],
)

cc_test(
    name = "slice_solver_workspace_test",
    size = "small",
    srcs = ["slice_solver_workspace_test.cc"],
    deps = [
        "//src:slice_solver_workspace",
        "//src:american_option",
        "@googletest//:gtest_main",
    ],
    copts = ["-std=c++20", "-fopenmp"],
    linkopts = ["-fopenmp"],
)

cc_test(
    name = "operator_factory_test",
    srcs = ["operator_factory_test.cc"],
    deps = [
        "//src/operators:operator_factory",
        "//src/operators:black_scholes_pde",
        "//src:grid",
        "@googletest//:gtest_main",
    ],
    copts = ["-std=c++20"],
)

cc_test(
    name = "spatial_operator_integration_test",
    srcs = ["spatial_operator_integration_test.cc"],
    deps = [
        "//src/operators:operator_factory",
        "//src/operators:black_scholes_pde",
        "//src:spatial_operators",  # Old operators for comparison
        "//src:grid",
        "@googletest//:gtest_main",
    ],
    copts = ["-std=c++20"],
)

cc_test(
    name = "thomas_cubic_spline_test",
    srcs = ["thomas_cubic_spline_test.cc"],
    deps = [
        "//src:thomas_solver",
        "//src:cubic_spline_solver",
        "@googletest//:gtest_main",
    ],
    copts = ["-std=c++20"],
)

cc_test(
    name = "bspline_basis_test",
    srcs = ["bspline_basis_test.cc"],
    deps = [
        "//src:bspline_basis_1d",
        "@googletest//:gtest_main",
    ],
    copts = ["-std=c++20", "-Wall", "-Wextra"],
)

cc_test(
    name = "bspline_collocation_1d_test",
    srcs = ["bspline_collocation_1d_test.cc"],
    deps = [
        "//src:bspline_collocation_1d",
        "//src:bspline_4d",
        "@googletest//:gtest_main",
    ],
    copts = ["-std=c++20", "-Wall", "-Wextra"],
)

cc_test(
    name = "bspline_4d_test",
    srcs = ["bspline_4d_test.cc"],
    deps = [
        "//src:bspline_4d",
        "@googletest//:gtest_main",
    ],
    copts = ["-std=c++20", "-Wall", "-Wextra", "-O3", "-march=native"],
)

cc_test(
    name = "bspline_fitter_4d_test",
    srcs = ["bspline_fitter_4d_test.cc"],
    deps = [
        "//src:bspline_fitter_4d",
        "//src:bspline_4d",
        "@googletest//:gtest_main",
    ],
    copts = ["-std=c++20", "-Wall", "-Wextra", "-O3", "-march=native"],
)

cc_test(
    name = "price_table_iv_integration_test",
    srcs = ["price_table_iv_integration_test.cc"],
    deps = [
        "//src:price_table_4d_builder",
        "//src:price_table_snapshot_collector",
        "//src:iv_solver_interpolated",
        "//src:american_option",
        "//src:bspline_fitter_4d",
        "//src:bspline_4d",
        "@googletest//:gtest_main",
    ],
    copts = ["-std=c++20", "-Wall", "-Wextra"],
)

# Test suites defined for convenience
# Fast tests: bazel test //tests/... --test_tag_filters=-manual,-slow
# Slow tests: bazel test //tests/... --test_tag_filters=slow
