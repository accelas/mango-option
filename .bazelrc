# Bazel configuration file
# Note: Use .bazelignore to exclude directories from analysis

# Common flags
build --color=yes
test --color=yes
test --test_output=errors

# Treat warnings as errors
build --copt=-Werror

# Arrow persistence feature (enabled by default)
build --define=enable_arrow=true

# Use GCC compiler (default)
# Clang investigation results:
#   - Clang + libc++: Blocked by system library ABI incompatibility
#   - Clang + libstdc++: Blocked by C++23 symbol inlining issues
# GCC 14.2 + libstdc++ works perfectly and supports all C++23 features we need
# build --action_env=CC=gcc
# build --action_env=CXX=g++

# C++ toolchain configuration
# All C++ flags (std, warnings, ISA) are configured in //toolchain:cc_toolchain_config.bzl
# To use the custom toolchain: --extra_toolchains=//toolchain:cc_toolchain_for_k8
# Or it's registered by default in MODULE.bazel

# Clang + libstdc++ toolchain configuration
# Use --config=clang to build with Clang instead of GCC
# NOTE: Has C++23 ABI issues (std::span ODR violations) - not recommended.
# See toolchain/cc_toolchain_config_clang.bzl for details.
build:clang --extra_toolchains=//toolchain:cc_toolchain_clang_for_k8
build:clang --action_env=CC=clang
build:clang --action_env=CXX=clang++

# Clang + libc++ toolchain configuration for fuzz testing
# Use --config=fuzz for FuzzTest (requires Earthly container with libc++)
# Run via: earthly +fuzz-test
# NOTE: Incompatible with Python bindings (pybind11), so only for fuzz tests.
build:fuzz --extra_toolchains=//toolchain:cc_toolchain_fuzz_for_k8
build:fuzz --action_env=CC=clang-19
build:fuzz --action_env=CXX=clang++-19

# Kokkos backend configurations
build:openmp --define=kokkos_backend=openmp
build:sycl --define=kokkos_backend=sycl
build:cuda --define=kokkos_backend=cuda
build:hip --define=kokkos_backend=hip

# Default to OpenMP for development
build --config=openmp
